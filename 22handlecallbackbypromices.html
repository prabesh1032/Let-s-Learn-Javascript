<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solving callback hell using promises</title>
</head>

<body>
    <div>
        <h1>Solving callback hell using promises</h1>
        <div id="first"></div>
    </div>

    <script>
        const orderDetails = {
            orderId: 12345,
            orderItems: ['Pizza', 'Pasta', 'Salad'],
            totalAmount: 29.99,
            customerName: 'ram',
            customerLocation: 'Nepal'
        };

        function placeOrder(orderDetails) {

            console.log("Order Placed by " + orderDetails.customerName + ". Getting the order details...");
            return new Promise((resolve, reject) => {
            setTimeout(function () {
                if ( !orderDetails.customerName) {
                    return reject(new Error("Invalid order details"));//if customerName is missing, reject the promise it will stop further execution
                }
                console.log("Order details received. Preparing the order...of totle amount $" + orderDetails
                    .totalAmount);
                    return resolve(orderDetails);
            }, 3000);
        });
        }

        function prepareOrder(orderDetails) {
            console.log("Order is being prepared. Please wait..." + orderDetails.customerName);
            return new Promise((resolve, reject) => {
            setTimeout(function () {
                console.log("Order prepared. Getting the payment details...");
                return resolve(orderDetails);
            }, 3000);
        });
        }

        function pickUpOrder(orderDetails) {
            console.log("Order is ready for pickup at " + orderDetails.customerLocation +
                ". Please collect your order.");
            return new Promise((resolve, reject) => {
            setTimeout(function () {
                console.log("Order picked up. Enjoy your meal!");
                return resolve(orderDetails);

            }, 3000);
        });
        }

        function completeOrder(orderDetails) {
            console.log("Order(" + orderDetails.orderId + ") is complete. Thank you " + orderDetails.customerName +
                " for dining with us!");
            return new Promise((resolve, reject) => {
            setTimeout(function () {
                console.log("We hope to see you again soon!");
                return resolve(orderDetails);
            }, 3000);
        });
        }

        placeOrder(orderDetails).then((orderDetails) => {
            return prepareOrder(orderDetails);
        }).then((orderDetails) => {
            return pickUpOrder(orderDetails);
        }).then((orderDetails) => {
            return completeOrder(orderDetails);
        }).catch((error) => {
            console.log("Error processing order: " + error.message);
        }).finally(() => {
            console.log("Order process ended.");
        });

        //explaining the above code
        //each function now returns a promise
        //we can chain the promises using .then() method
        //if any promise is rejected, the .catch() method will handle the error
        //here we have avoided callback hell by using promises and chaining them
        //first we call placeOrder() which returns a promise
        //once the promise is resolved, we call prepareOrder() in the .then() method
        //similarly we call pickUpOrder() and completeOrder() in the subsequent .then() methods
        //if any error occurs in any of the promises, the .catch() method will handle it
        //finally, the .finally() method will execute regardless of the promise being resolved or rejected

    </script>

    

</body>

</html>